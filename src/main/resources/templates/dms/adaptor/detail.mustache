{{>layout/header}}

        <div class="right_col" role="main">
          <div class="row">
            <div class="col-md-12">
              <div class="x_panel"> 
                <div class="x_title"> 
                  <h2>Adapter 상세</h2>
                  <div class="clearfix"> </div>
                </div>
                <div class="x_content"> <br>
                  <div class="cont_title_box">
                    <h3>Adapter 상세</h3>
                    <div class="right_btns"><a class="btn btn-primary" href="table.html">목록 </a></div>
                  </div>
                  <div class="border_rows">
                    <div class="row">
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">Adapter 명</div>
                        <div class="form-control_box"><span id="adapter_nm"></span></div>
                      </div>
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">Adapter 유형</div>
                        <div class="form-control_box"><span id="adapter_type_nm"></span></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">사용 여부</div>
                        <div class="form-control_box"><span id="use_yn"></span></div>
                      </div>
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label"></div>
                        <div class="form-control_box"></div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="cont_title_box">
                    <h3>Instance 목록</h3>
                    <div class="right_btns"><button class="btn btn-primary">등록</button></div>
                  </div>
                                    
                  <div class="table_responsive">
                    <div class="talbel_total">총 <span id="total_count"></span>1건</div>
                    <table class="table table-striped">
                      <colgroup> 
                        <col width="5px">                      
                        <col width="10px">                      
                        <col width="15px">                      
                        <col width="22px">                      
                        <col width="10px">                      
                        <col width="10px">                      
                        <col width="10px">                      
                        <col width="10px">                      
                        <col width="8px">                      
                      </colgroup>
                      <thead>
                        <tr> 
                          <th style="text-align: center;">순번</th>
                          <th style="text-align: center;">Instance 명</th>
                          <th style="text-align: center;">데이터 셋 명</th>
                          <th style="text-align: center;">접속설정/매칭정보</th>
                          <th style="text-align: center;">수집방식</th>
                          <th style="text-align: center;">수집유형</th>
                          <th style="text-align: center;">수집스케줄 유형</th>
                          <th style="text-align: center;">시계열 데이터</th>
                          <th style="text-align: center;">사용여부</th>
                        </tr>
                      </thead>
                      <tbody id="dpIngestAdapterIt">
                        <tr>
                          <td style="text-align: center;">문화재명1</td>
                          <td style="text-align: center;">11</td>
                          <td style="text-align: center;">1111</td>
                          <td style="text-align: center;">1</td>
                          <td style="text-align: center;">1</td>
                          <td style="text-align: center;">1</td>
                          <td style="text-align: center;">성공</td>
                          <td style="text-align: center;">2019. 6. 18 오후 1:07:39</td>
                          <td style="text-align: center;">2019. 6. 18 오후 1:07:39</td>
                        </tr>
                      </tbody>
                    </table>
                    <div class="nav justify-content-center"> 
					  <ul id="pagingul" class="pagination">
					  </ul>                    
                    </div>   
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
{{>layout/footer}}        

<script>
document.title = 'LX DMS | Adaptor 설정';
const commonUrl = '/common';
const url = '/adaptor';

let init_page = 1;				//초기 페이지
let page = 1;					//페이지
let init_size_per_page = 10;	//초기 개수
let size_per_page = 10;	 		//가져올 개수
let pageCount = 10;		 		//페이징에 나타낼 페이지 수

//Instance 목록 조회
const dpIngestAdapterIt = function(page, size_per_page){
	
	if(!page){
		page = init_page;
	}
	if(!size_per_page){
		size_per_page = init_size_per_page;
	}
	
    const data = {
	   		url: '/dp/ingest/adapter/instance',
	   		adapter_id: "{{adapter_id}}",	
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',
	   		page_current: page,	   		
	    };		
	    
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpIngestAdapterIt',
	        dataType: 'json',
	        contentType: 'application/json; charset-utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
	    	
			  $("#dpIngestAdapterIt").empty();
		  	  if (data != null) {
	  	    	$("#total_count").text(data.total_count);
	  	    	
	  	    	if(data.contents != ""){
	  	    		
		     	    let insertTr = '';
		     	    let i = 0;	
			  	    $.each(data.contents, function (idx, el) {

		     	          insertTr += '<tr>';
		     		      insertTr += '	<td style="text-align: center;">'+(++i)+'</td>';
		     		      insertTr += ' <td style="text-align: center;"><span class="blue bold" style="cursor:pointer" onclick=modModal("'+el.instance_id+'");>'+isEmpty(el.instance_nm)+'</span></td>';
		     		      insertTr += ' <td style="text-align: center;">'+isEmpty(el.dset_korean_nm)+'</td>';
		     		      insertTr += ' <td style="text-align: center;">';
		     		      insertTr += '	<button class="btn btn-sm btn-primary" onclick=operationPage("'+ el.adapter_id +'")>접속설정</button>';
		     		      insertTr += '	<a href="'+el.url_mix+'" target="_blank"><button class="btn btn-sm btn-primary">매칭정보</button></a>';
		     		      insertTr += ' </td>';	     		      
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.clct_mthd)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.clct_ty)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.schedule_type)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.time_data_yn)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.use_yn)+'</td>';
		                  insertTr += '</tr>';
			  	    });
	          	    $("#dpIngestAdapterIt").append(insertTr);
	  	    	}
	  	    	
	  	    	//페이징 보여줌
	  	    	paging(data.total_count, size_per_page, pageCount, page);
	  	    	
		  	  }
	    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });
}

//Adapter 상세 조회
const dpIngestAdapterDt = function(){
	
    const data = {
	   		url: '/dp/ingest/adapter/detail',
	   		adapter_id: "{{adapter_id}}",	
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',
	    };		
	    
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpIngestAdapterDt',
	        dataType: 'json',
	        contentType: 'application/json; charset-utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
	    	
	    	  let adapter_id;
	    	  let adapter_nm;
	    	  let adapter_type_id;
	    	  let adapter_type_nm;
	    	  let use_yn;
		  	  if (data != null) {
			  	   	if(data.contents != ""){    	
		    	   		 $.each(data.contents, function (idx, el) {
		    	   			adapter_id = el.adapter_id;
		    	   			adapter_nm = el.adapter_nm;
		    	   			adapter_type_id = el.adapter_type_id;
		    	   			adapter_type_nm = el.adapter_type_nm;
		    	   			use_yn = el.use_yn;
		 	     	     });
			  	   	}
		  	  }
		  	  
   	   		  $("#adapter_nm").text(adapter_nm);
   	   		  $("#adapter_type_nm").text(adapter_type_nm);
   	   		  $("#use_yn").text(useYnText(use_yn));
	    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });
	    
	    dpIngestAdapterIt(page, size_per_page);
}

//text 
const useYnText = function(use_yn){

	if(use_yn === "Y"){
		return "사용"
	}else{
		return "사용안함"
	}
}

dpIngestAdapterDt();
</script>


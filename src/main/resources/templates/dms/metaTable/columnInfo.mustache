{{>layout/header}}

	<div class="right_col" role="main">
	    <div class="row">
	        <div class="col-md-12">
	            <div class="x_panel">
	                <div class="x_title"> 
	                  <h2>HOME > 메타테이블 관리</h2>
	                  <div class="clearfix"> </div>
	                </div>
	                <div class="x_content">
	                	<div class="border_rows">
		                    <div class="row">
		                      <div class="form-group row col-12 col-md-6">
		                        <div class="control-label">테이블 한글명</div>
		                        <div class="form-control_box">
		                        	<input class="form-control" type="text">
		                        </div>
		                      </div>
		                      <div class="form-group row col-12 col-md-6">
		                        <div class="control-label">테이블 영문명</div>
		                        <div class="form-control_box">
		                        	<input class="form-control" type="text">
		                        </div>
		                      </div>
		                    </div>
						</div>
	            	</div>
	        	</div>
	    	</div>
		</div>
		<div class="row">
		    <div class="col-md-12">
		        <div class="x_panel">
		            <div class="x_title">
		                <h3>컬럼 정보</h3>
		            </div>
		            <div class="x_content">
	                    <div class="table_btns mt-4">
	                    	<button class="btn btn btn-dark" type="button" onclick="history.back();return false;">목록</button>
	                    	<button class="btn btn-primary" type="button" onclick="btnAdd();">추가</button>
	                    	<button class="btn btn-danger" type="button">삭제</button>
                    	</div>
		                <div class="table_responsive" style="height: 500px; overflow: auto">
		                	<div class="talbel_total">총 <span class="red bold" id="total_count"></span>건</div>
		                    <table class="table table-striped" style="text-align: center;">
		                        <colgroup>
		                            <col width="55px">
		                        </colgroup>
		                        <thead>
		                            <tr>
		                                <th>선택</th>
		                                <th>한글명</th>
		                                <th>영문명</th>
		                                <th>데이터타입</th>
		                                <th>데이터길이</th>
		                                <th>Not null 여부</th>
		                                <th>데이터셋종류</th>
		                                <th>PK 정보</th>
		                                <th>FK 정보</th>
		                                <th>개인정보여부</th>
		                                <th>암호화여부</th>
		                                <th>정렬순서</th>
		                            </tr>
		                        </thead>
		                        <tbody id="columnInfo">
		                        </tbody>
		                    </table>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
		<div id="tbl_layer" style="display: none;">
			<div class="row" id="dataset_layer">
			    <div class="col-md-12">
			        <div class="x_panel">
			            <div class="x_title">
			                <h3>컬럼 항목</h3>
			                <div class="clearfix"> </div>
			            </div>
			            <div class="x_content">
			            	<div class="table_btns mt-4">
		                    	<button class="btn btn-primary" type="button">저장</button>
	                    	</div>
	                    	<div class="table_responsive">
			                    <table class="table table-bordered bulk_action table_center">
			                        <colgroup>
			                        </colgroup>
			                        <thead>
				                        <tr>
				                            <th>한글명</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="column_korean_nm" id="column_korean_nm">
				                            </th>
				                            <th>참조 테이블 식별자</th>
				                            <th colspan="3">
				                            	<div class="form-control_box duplicate_box">
					                            	<input class="form-control" type="text"  name="refrn_table_idntfc_id" id="refrn_table_idntfc_id" readonly="readonly">
					                            	<button class="btn btn-primary" onclick="addModal();"> <i class="glyphicon glyphicon-search"></i></button>
				                            	</div>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>영문명</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="column_eng_nm" id="column_eng_nm">
				                            </th>
				                            <th>참조 테이블명</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="refrn_table_idntfc_id_nm" id="refrn_table_idntfc_id_nm" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>데이터타입</th>
				                            <th>
				                                <select class="form-control" name="data_type" id="data_type">
				                                    <option value="VARCHAR">VARCHAR</option>
				                                    <option value="INTEGER">INTEGER</option>
				                                    <option value="NUMERIC">NUMERIC</option>
				                                    <option value="TIMESTAMPTZ">TIMESTAMPTZ</option>
				                                </select>
				                            </th>
				                            <th>데이터 길이</th>
				                            <th>
				                                <input class="form-control" type="text" name="data_lt" id="data_lt">
				                            </th>
				                            <th>참조 컬럼 식별자</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text"  name="refrn_column_idntfc_id" id="refrn_column_idntfc_id" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>Not null 여부</th>
				                            <th>
				                                <select class="form-control" name="not_null_at" id="not_null_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>데이터셋 종류</th>
				                            <th>
				                                <select class="form-control" name="dset_knd" id="dset_knd">
				                                    <option value="D">데이터</option>
			                                    	<option value="M">메타정보</option>
				                                </select>
				                            </th>
				                            <th>참조 컬럼명</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="refrn_column_idntfc_id_eng_nm" id="refrn_column_idntfc_id_eng_nm" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>PK 정보</th>
				                            <th>
				                                <select class="form-control" name="pk_info" id="pk_info">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>FK 정보</th>
				                            <th>
				                                <select class="form-control" name="fk_info" id="fk_info">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>수집 테이블 생성 여부</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="creat_table_at" id="creat_table_at" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>사용 여부</th>
				                            <th>
				                                <select class="form-control" name="use_at" id="use_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>컬럼 저장 타입</th>
				                            <th>
				                                <input class="form-control" type="text" name="column_stre_type" id="column_stre_type" readonly="readonly">
				                            </th>
				                            <th rowspan="3">컬럼 설명</th>
				                            <th rowspan="3">
				                                <textarea name="column_dc" id="column_dc" rows="6" style="width: 100%;"></textarea>
				                            </th>
				                            <th rowspan="3">CRUD 설명</th>
				                            <th rowspan="3">
				                                <textarea name="crud_dc" id="crud_dc" rows="6" style="width: 100%;"></textarea>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>정렬 순서</th>
				                            <th>
				                                <input class="form-control" type="text" name="ordr" id="ordr">
				                            </th>
				                            <th>개인정보 여부</th>
				                            <th>
				                                <select class="form-control" name="indvdl_info_at" id="indvdl_info_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>암호화 여부</th>
				                            <th>
				                                <select class="form-control" name="encpt_at" id="encpt_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>CRUD 구분</th>
				                            <th>
				                                <input class="form-control" type="text" name="crud_se" id="crud_se">
				                            </th>
				                        </tr>
			                        </thead>
			                    </table>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
		</div>
	</div>
	<!-- modal -->
        <div class="modal fade add_modal" id="add_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-md">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">참조 테이블 검색</h4>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
              	<form class="form-horizontal form-label-left">
	              	<div class="row">
	                  <div class="form-group row col-12 col-md-10">
	                    <input class="form-control" type="text">
	                  </div>
	                    <button class="btn-sm btn-primary" type="button">검색</button>
	                </div>
	                <div class="table_responsive" style="height: 300px; overflow: auto">
                    <table class="table table-striped" style="text-align: center;">
                      <thead>
                        <tr> 
                          <th rowspan="2" style="vertical-align: middle;">데이터셋 한글</th>
                          <th colspan="2">테이블명</th>
                        </tr>
                        <tr>
                          <th>영문</th>
                          <th>국문</th>
                        </tr>
                      </thead>
                      <tbody>
                      	<tr>
                      		<td>데이터셋1</td>
                      		<td>TB_NAME_01</td>
                      		<td>지역문화제</td>
                      	</tr>
                      	<tr>
                      		<td>데이터셋1</td>
                      		<td>TB_NAME_01</td>
                      		<td>지역문화제</td>
                      	</tr>
                      	<tr>
                      		<td>데이터셋1</td>
                      		<td>TB_NAME_01</td>
                      		<td>지역문화제</td>
                      	</tr>
                      </tbody>
                    </table>
                  </div>
	            </form>
              </div>
            </div>
          </div>
        </div>
        
{{>layout/footer}}        

<script>

const commonUrl = '/common';
const url = '/metaTable';

let init_page = 1;				//초기 페이지
let page = 1;					//페이지
let init_size_per_page = 10;	//초기 개수
let size_per_page = 10;	 		//가져올 개수
let pageCount = 10;		 		//페이징에 나타낼 페이지 수

//메타테이블 컬럼 항목
const dpIngestMetaTblCol = function () {
	
	let table_idntfc_id = '{{table_idntfc_id}}';
	
	const data = {
   		url: '/dp/ingest/meta/tables/column',
   		user_id: 'user00',
   		table_idntfc_id: table_idntfc_id,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestMetaTblCol',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#total_count").text(data.totalCount);
  	    	if(data.contents != ""){
  	    		let insertTr = '';
  	    		$.each(data.contents, function (idx, el) {
	  	    		insertTr += '<tr>';
		  	    	insertTr += '	<td><input type="checkbox"></td>';
		  	    	insertTr += '	<td>'+isEmpty(el.column_korean_nm)+'</td>';
		  	    	insertTr += '	<td><span class="blue bold" style="cursor:pointer" onclick=dpIngestMetaTblColDt(\''+el.column_idntfc_id+'\');>'+isEmpty(el.column_eng_nm)+'</span></td>';
		  	    	insertTr += '	<td>'+isEmpty(el.data_type)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.data_lt)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.not_null_at)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.dset_knd)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.pk_info)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.fk_info)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.indvdl_info_at)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.encpt_at)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.ordr)+'</td>';
		  	    	insertTr += '</tr>';
  	    		});
  	    		$("#columnInfo").html(insertTr);
  	    	}
	  	  }
    	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//메타테이블 컬럼 항목 상세
const dpIngestMetaTblColDt = function (column_idntfc_id) {
	
	btnDetail();
	let table_idntfc_id = '{{table_idntfc_id}}';
	
	const data = {
   		url: '/dp/ingest/meta/tables/column/detail',
   		user_id: 'user00',
   		table_idntfc_id: table_idntfc_id,
   		column_idntfc_id: column_idntfc_id,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestMetaTblColDt',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		  
  	    	if(data.contents != ""){
  	    		
  	    		$.each(data.contents, function (idx, el) {
  	    			
  	    			$("#column_korean_nm").val(el.column_korean_nm);
  	    			$("#refrn_table_idntfc_id").val(el.refrn_table_idntfc_id);
  	    			$("#column_eng_nm").val(el.column_eng_nm);
  	    			$("#refrn_table_idntfc_id_nm").val(el.refrn_table_idntfc_id_nm);
  	    			$("#data_type").val(el.data_type).prop("selected", true);
  	    			$("#data_lt").val(el.data_lt);
  	    			$("#refrn_column_idntfc_id").val(el.refrn_column_idntfc_id);
  	    			$("#not_null_at").val(el.not_null_at).prop("selected", true);
  	    			$("#dset_knd").val(el.dset_knd).prop("selected", true);
  	    			$("#refrn_column_idntfc_id_eng_nm").val(el.refrn_column_idntfc_id_eng_nm);
  	    			$("#pk_info").val(el.pk_info).prop("selected", true);
  	    			$("#fk_info").val(el.fk_info).prop("selected", true);
  	    			$("#creat_table_at").val(el.creat_table_at);
  	    			$("#use_at").val(el.use_at).prop("selected", true);
  	    			$("#column_stre_type").val(el.column_stre_type);
  	    			$("#column_dc").val(el.column_dc);
  	    			$("#crud_dc").val(el.crud_dc);
  	    			$("#ordr").val(el.ordr);
  	    			$("#indvdl_info_at").val(el.indvdl_info_at).prop("selected", true);
  	    			$("#encpt_at").val(el.encpt_at).prop("selected", true);
  	    			$("#crud_se").val(el.crud_se);
  	    			
  	    		});
  	    	}
	  	  }
    	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//추가 버튼
const btnAdd = function(){
	if($("#tbl_layer").css("display") == "none"){
	    $("#tbl_layer").show();
	    let offset = $('#dataset_layer').offset();
	    $('html').animate({scrollTop : offset.top}, 300);
	} else {
	    $("#tbl_layer").hide();
	}
}

//상세 버튼
const btnDetail = function(){
	$("#tbl_layer").show();
    let offset = $('#dataset_layer').offset();
    $('html').animate({scrollTop : offset.top}, 300);
}

//모달 추가
const addModal = function(){
	$('#add_modal').modal('show');
}

dpIngestMetaTblCol();

</script>

